#!/bin/sh
#
# Daily Maintenance
#

. $(dirname $0)/common

# Remove old logs
find "${LOG}" -depth -mtime +30 -print0 | xargs -0 rm -rf

# Clear out the black hole.  Prune writes empty logs here.
rm -rf ${HOLE}/*

# Prune old snapshots
do_maint && log prune "${BIN}/prune"

# Do a self-update.
if [ -n "${CONFIG_AUTO_UPDATE}" ]
then
    UPDATE_DIR="${VAR}/update"
    [ -d "${UPDATE_DIR}/.git" ] \
	|| die "Unable to find sources in ${UPDATE_DIR}"

    log update make -C "${UPDATE_DIR}" DEST="${TOP}" ROOT="${TOP}/root" update
fi

exit 0
